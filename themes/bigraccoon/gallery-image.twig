{#
 # A template to present a single gallery image, or a grouping of multiple images.  It will have a date, H2 title,
 # and prev/next buttons.  Metadata will be provided with each main image.  Finally, other related images can be
 # displayed as thumbnails (just like in the main gallery listing).
 #}
 
{% extends "_base.twig" %}


{% block html_head %}

	{# If, when this page loads, the user is logged in, the page should immdiately redirect to an actual destination page #}
	{% if meta.adultonly and username != "eighteen" %}

		{# The HTML head will consist only of redirect code #}
		<script>
			window.location.href = "{{ pages[destination_id].url }}"
		</script>
		<noscript>
			<meta http-equiv="refresh" content="0; url={{ pages[destination_id].url }}">
		</noscript>

	{% else %}

		{# The user is logged out, so this page should load like a normal one #}
		{{ parent() }}
		
	{% endif %}

{% endblock html_head %}



{# Need to use Twig to put the main image into the background, overriding the external CSS style file #}
{% block head_style %}
	{{ parent() }}
	<style>
		#wrapper > .bg { background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.1)), url("/{% if meta.image %}{{ resize( 'assets/' ~ meta.image, null, 800 ) }}{% else %}{{ 'assets/' ~ current_parent.meta.image }}{% endif %}"); }
	</style>
{% endblock head_style %}


{% block head_style_noscript %}
		{{ parent() }}
		<style>
			#wrapper { background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.1)), url("/{% if meta.image %}{{ resize( 'assets/' ~ meta.image, null, 800 ) }}{% else %}{{ current_parent.meta.image }}{% endif %}"); }
		</style>
{% endblock head_style_noscript %}
		

{% block page_body %}

	{# Use prev/next browsing buttons that include thumbnail images #}
	{{ include("_segment-gallery-pagination.twig") }}

				<!-- A post -->
				<section class="post">
				
					<header class="major">
						{% if meta.date %}<span class="date">{{ meta.date_formatted }}</span>{% endif %}
						{% if meta.title %}<h2>{{ meta.title }}</h2>{% endif %}
					</header>
					
					
					{# Display the primary image #}
					<div class="gallery-image" id="main-image">
						{# Clicking the image will simply open the original, full-size image file (which could be huge) #}
						<a href="{{ assets_url }}/{{ meta.image }}">
						
							{# The image displayed here is resized, so that browsing isn't slowed down by very large images #}
							<img src="/{{ resize( 'assets/' ~ meta.image, null, 800 ) }}"{% if meta.imagedescription %} alt="{{ meta.imagedescription }}"{% endif %}>
							
						</a>
					</div>


			{# If there are more images in this group, display them next #}
			{% if meta.moreimages %}
				{% for image in meta.moreimages %}
						
					<div class="gallery-image">
						<a href="{{ assets_url }}/{{ image.file }}">
							<img src="/{{ resize( 'assets/' ~ image.file, null, 800 ) }}"{% if image.description %} alt="{{ image.description }}"{% endif %}>
						</a>
					</div>
	
				{% endfor %}
			{% endif %}
			
			
			{# If there are related images, display them as thumbnails #}
			{% if meta.related %}
					<h3>Related Images</h3>
					<div id="thumbnails">
					{% for image in meta.related %}
						{% set imagepage = pages['gallery/' ~ image] %}
						<a href="{{ imagepage.url }}">
							{# The resize() function comes from the Pico plugin ImageResize #}
							<img src="/{{ resize( 'assets/' ~ imagepage.meta.image, null, 300 ) }}"{% if imagepage.meta.imagedescription %} alt="{{ imagepage.meta.imagedescription }}"{% endif %}>
						</a>
					{% endfor %}
					</div>
						
			{% endif %}

					
					<p>{{ content }}</p>
					
					{{ include("_segment-comments.twig") }}
					
				</section>

	{{ include("_segment-gallery-pagination.twig") }}
{% endblock page_body %}

{% block scripts %}
	{# Add lightbox elements and script #}
	{{ include("_segment-lightbox.twig") }}
	
	{{ parent() }}
	
	{# Include thumbnail scripting if related images exist for this image #}
	{% if meta.related %}
		<script src="{{ theme_url }}/js/bigraccoon-gallery.js"></script>
	{% endif %}
{% endblock scripts %}